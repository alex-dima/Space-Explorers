A more complex version of the well known multi threading problem "Multiple Producers Multiple Consumers"